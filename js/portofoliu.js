document.addEventListener('DOMContentLoaded',()=>{const filterButtons=document.querySelectorAll('#portfolio-flters li');const portfolioCards=document.querySelectorAll('.portfolio-card');const stickyContact=document.querySelector('.stickyContact');const stickyCopyright=document.querySelector('.stickyCopyright');const portfolioGrid=document.querySelector('.portfolio-grid');const navbar=document.querySelector('.navbar');const modal=document.getElementById('fullscreen-modal');const imagesContainer=document.getElementById('modal-images-container');const categoryButtons=document.getElementById('category-buttons');const categoryTitle=document.getElementById('modal-category-title');const prevBtn=document.getElementById('prev-image');const nextBtn=document.getElementById('next-image');let isMobile=window.innerWidth<=991;stickyContact.style.opacity='0';stickyCopyright.style.opacity='0';stickyContact.style.pointerEvents='none';stickyCopyright.style.pointerEvents='none';function getFooterPadding(){const contactHeight=stickyContact.offsetHeight;const copyrightHeight=stickyCopyright.offsetHeight;return contactHeight+copyrightHeight+15}
function updateVisibility(){const gridBottom=portfolioGrid.getBoundingClientRect().bottom;const windowHeight=window.innerHeight;const distanceToBottom=gridBottom-windowHeight;let shouldShow=!1;if(distanceToBottom<=100){const opacity=1-(distanceToBottom/100);shouldShow=opacity>0;if(isMobile){if(opacity>0.9){navbar.style.transform='translateY(-100%)';navbar.style.transition='transform 0.3s ease'}else{navbar.style.transform='translateY(0)'}}}else{navbar.style.transform='translateY(0)'}
if(shouldShow){stickyContact.classList.add('show');stickyCopyright.classList.add('show')}else{stickyContact.classList.remove('show');stickyCopyright.classList.remove('show')}}
window.addEventListener('load',()=>{portfolioCards.forEach(card=>card.style.display='block');portfolioGrid.style.paddingBottom=`${getFooterPadding()}px`;updateVisibility()});let currentPageCategory='toate';function scrollPageCategoryIntoView(category){const filterList=document.getElementById('portfolio-flters');const activeFilter=Array.from(filterButtons).find(btn=>btn.getAttribute('data-filter')===category);if(activeFilter&&filterList){const btnLeft=activeFilter.offsetLeft;const containerWidth=filterList.clientWidth;const btnWidth=activeFilter.offsetWidth;const scrollPosition=btnLeft-(containerWidth/2)+(btnWidth/2);filterList.scrollTo({left:scrollPosition,behavior:'smooth'})}}
function updatePageFilter(category){filterButtons.forEach(btn=>{const isActive=btn.getAttribute('data-filter')===category;btn.classList.toggle('active',isActive)});portfolioCards.forEach(card=>{if(category==='toate'){card.style.display='block'}else{const cardCategory=card.getAttribute('data-category');card.style.display=cardCategory===category?'block':'none'}});currentPageCategory=category;scrollPageCategoryIntoView(category)}
filterButtons.forEach(button=>{button.addEventListener('click',()=>{const selectedFilter=button.getAttribute('data-filter');updatePageFilter(selectedFilter)})});let resizeTimeout;window.addEventListener('resize',()=>{isMobile=window.innerWidth<=991;if(!isMobile){navbar.style.transform='translateY(0)'}
clearTimeout(resizeTimeout);resizeTimeout=setTimeout(()=>{portfolioGrid.style.paddingBottom=`${getFooterPadding()}px`;updateVisibility()},100)});let ticking=!1;window.addEventListener('scroll',()=>{if(!ticking){window.requestAnimationFrame(()=>{updateVisibility();ticking=!1});ticking=!0}});let currentCategory='toate';let allImages={};function collectImages(){const categories=['toate','peisagistica','mentenanta-plante','mentenanta-gradina','irigare-drenaj','tehnologii','gradinarit'];categories.forEach(category=>{if(category==='toate'){allImages[category]=Array.from(document.querySelectorAll('.portfolio-card img'))}else{allImages[category]=Array.from(document.querySelectorAll(`.portfolio-card[data-category="${category}"] img`))}})}
function loadCategoryImages(category,startIndex=0){imagesContainer.innerHTML='';const images=allImages[category];images.forEach((img,index)=>{const wrapper=document.createElement('div');wrapper.className='fullscreen-image-wrapper';const image=document.createElement('img');image.src=img.src;image.alt=img.alt;wrapper.appendChild(image);imagesContainer.appendChild(wrapper);if(index===startIndex){setTimeout(()=>wrapper.scrollIntoView({behavior:'auto'}),100)}});const scrollIndicator=document.createElement('div');scrollIndicator.className='scroll-indicator';imagesContainer.appendChild(scrollIndicator);imagesContainer.addEventListener('scroll',()=>{if(imagesContainer.scrollTop>100){modal.classList.add('scrolled')}else{modal.classList.remove('scrolled')}},{passive:!0})}
function updateCategoryButtons(activeCategory){document.querySelectorAll('.category-btn').forEach(btn=>{btn.classList.toggle('active',btn.dataset.category===activeCategory)})}
function scrollCategoryIntoView(category){const categoryBtn=Array.from(document.querySelectorAll('.category-btn')).find(btn=>btn.dataset.category===category);if(categoryBtn){const container=categoryButtons;const btnLeft=categoryBtn.offsetLeft;const containerWidth=container.clientWidth;const btnWidth=categoryBtn.offsetWidth;const scrollPosition=btnLeft-(containerWidth/2)+(btnWidth/2);container.scrollTo({left:scrollPosition,behavior:'smooth'})}}
document.querySelectorAll('.portfolio-card img').forEach(img=>{img.addEventListener('click',()=>{const card=img.closest('.portfolio-card');currentCategory=currentPageCategory;const currentIndex=Array.from(allImages[currentCategory]).indexOf(img);const modalInstance=new bootstrap.Modal(modal);modalInstance.show();modal.addEventListener('shown.bs.modal',function onShown(){updateCategoryButtons(currentCategory);loadCategoryImages(currentCategory,currentIndex);const categoryBtn=Array.from(document.querySelectorAll('.category-btn')).find(btn=>btn.dataset.category===currentCategory);if(categoryBtn){const container=categoryButtons;const btnLeft=categoryBtn.offsetLeft;const containerWidth=container.clientWidth;const btnWidth=categoryBtn.offsetWidth;const scrollPosition=btnLeft-(containerWidth/2)+(btnWidth/2);container.scrollTo({left:scrollPosition,behavior:'instant'})}
modal.removeEventListener('shown.bs.modal',onShown)},{once:!0})})});categoryButtons.addEventListener('click',(e)=>{const btn=e.target.closest('.category-btn');if(!btn)return;currentCategory=btn.dataset.category;updateCategoryButtons(currentCategory);loadCategoryImages(currentCategory);updatePageFilter(currentCategory);scrollCategoryIntoView(currentCategory)});modal.addEventListener('hidden.bs.modal',()=>{updatePageFilter(currentCategory)});modal.addEventListener('show.bs.modal',()=>{if(imagesContainer){imagesContainer.scrollTop=0;modal.classList.remove('scrolled')}});collectImages();let currentImages=[];let currentIndex=0;function updateModalImage(){modalImage.src=currentImages[currentIndex].src;categoryTitle.textContent=currentImages[currentIndex].closest('.portfolio-card').getAttribute('data-category')}
function showNextImage(){currentIndex=(currentIndex+1)%currentImages.length;updateModalImage()}
function showPrevImage(){currentIndex=(currentIndex-1+currentImages.length)%currentImages.length;updateModalImage()}
prevBtn.addEventListener('click',showPrevImage);nextBtn.addEventListener('click',showNextImage);document.addEventListener('keydown',(e)=>{if(!modal.classList.contains('show'))return;if(e.key==='ArrowRight')showNextImage();if(e.key==='ArrowLeft')showPrevImage();if(e.key==='Escape')modal.querySelector('.btn-close').click();})})